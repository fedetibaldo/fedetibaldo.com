---
import { settings } from "../../settings";
import Footer from "./Footer.astro";
import "../../index.css";
import type { CollectionEntry } from "astro:content";
import { CardList } from "../card-list";
import type { FilterValue } from "../filter";
import { Filter } from "../filter";

export const sidebarImageSizes = {
	widths: [420, 640],
	sizes: "(max-width: 640px) 640px, 420px",
};

export type SidebarType = "filterable" | "suggested";

interface Props {
	title?: string | undefined;
	description?: string | undefined;
	sidebar: {
		type: SidebarType;
		defaultFilter?: Partial<FilterValue>;
		entries: CollectionEntry<"entries">[];
	};
}

const { title, description = settings.siteDescription, sidebar } = Astro.props;

const canonical = Astro.url.origin + Astro.url.pathname;
---

<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link rel="icon" href="/favicon.svg" />

		<title>{[title, settings.siteTitle].filter(Boolean).join(" | ")}</title>
		<meta name="description" content={description} />
		<link rel="canonical" href={canonical} />

		<!-- Privacy-friendly analytics by Plausible -->
		<script
			defer
			data-domain={settings.siteDomain}
			src="https://plausible.io/js/script.js"></script>
	</head>

	<body>
		<script is:inline>
			document.body.classList.add("js");
		</script>

		<div
			class="container px-2 lg:px-0 lg:grid grid-cols-10 min-h-full items-end"
		>
			<div
				class="col-span-6 xl:col-span-7 flex flex-col h-full min-h-fit max-h-dvh lg:sticky bottom-0"
			>
				<header
					class="sticky top-0 z-10 h-20 flex items-center bg-surface border-x border-b border-contrast-lowest px-4 lg:px-8"
				>
					<a
						class="text-ds-headline-1 bg-contrast-high text-custom-gradient"
						href="/"
					>
						{settings.siteTitle}
					</a>
				</header>

				<slot name="hero" />

				<main
					class="grow flex flex-col justify-center border-x border-b border-contrast-lowest px-4 lg:px-8 pt-12"
				>
					<slot />
				</main>

				<Footer
					class="hidden lg:block border-x border-contrast-lowest px-4 lg:px-8"
				/>
			</div>

			<aside
				class="col-span-4 xl:col-span-3 flex flex-col h-full min-h-fit max-h-dvh lg:sticky bottom-0"
			>
				<div
					class="sticky top-0 h-20 flex items-center bg-surface border-x lg:border-l-0 border-y lg:border-t-0 border-contrast-lowest px-4 lg:px-8 z-10"
				>
					{
						sidebar.type == "filterable" ? (
							<Filter client:idle defaultValue={sidebar.defaultFilter} />
						) : (
							<p class="text-contrast-low">Suggested items</p>
						)
					}
				</div>
				<CardList
					class="grow bg-surface border-x lg:border-l-0 border-b lg:border-b-0 border-contrast-lowest px-4 lg:px-8"
					imageSizes={sidebarImageSizes}
					entries={sidebar.entries}
				/>
			</aside>

			<Footer class="lg:hidden border-x border-contrast-lowest px-4 lg:px-8" />
		</div>
	</body>
</html>
